# System Contracts

This directory contains the interface definitions and contracts between domains and external systems in the Skafu application.

## Contract Types

### ðŸ“§ [Events](./events/)
AsyncAPI specifications for domain events and cross-service communication via EventBridge.

### âš¡ [Commands](./commands/)
Command definitions and API contracts for state-changing operations via API Gateway.

### ðŸ“Š [Data Models](./data-models/)
Shared data types, GraphQL schemas, and cross-domain model definitions.

## Contract Standards

### Event Contracts (AsyncAPI)
- **Format**: AsyncAPI 2.6.0 specification
- **Validation**: EventBridge Schema Registry
- **Versioning**: Semantic versioning in event metadata
- **Documentation**: Human-readable descriptions for all events

### API Contracts (OpenAPI)
- **Format**: OpenAPI 3.0.3 specification  
- **Validation**: API Gateway request validation
- **Authentication**: JWT bearer tokens via Cognito
- **Error Handling**: Standardized error response format

### Data Model Contracts (GraphQL)
- **Format**: GraphQL Schema Definition Language
- **Generation**: Auto-generated by Amplify Gen2
- **Types**: Shared types used across multiple domains
- **Relationships**: Cross-domain data relationships

## Contract Evolution

### Backward Compatibility
- **Events**: New optional fields only, existing fields immutable
- **APIs**: Additive changes only, version headers for breaking changes
- **Data Models**: Schema evolution through field additions

### Version Management
- **Events**: Version field in event metadata
- **APIs**: Version in URL path or headers
- **Data Models**: Schema registry version tracking

### Breaking Changes
- **Process**: RFC process for breaking changes
- **Migration**: Parallel version support during transition
- **Deprecation**: 6-month deprecation period for removed features

## Integration Patterns

### Event-Driven Integration
```
Domain A â†’ EventBridge â†’ Domain B
```

### Command Integration  
```
Frontend â†’ API Gateway â†’ Step Functions â†’ Domain
```

### Query Integration
```
Frontend â†’ Amplify Data API â†’ AppSync â†’ Read Models
```

## Contract Validation

### CI/CD Integration
- AsyncAPI validation in build pipeline
- OpenAPI specification testing
- GraphQL schema compatibility checks
- Contract change impact analysis

### Runtime Validation
- EventBridge schema validation
- API Gateway request/response validation
- GraphQL query validation
- Type safety enforcement

## Documentation Standards

### Event Documentation
- Business purpose and trigger conditions
- Data payload structure and constraints
- Consumer responsibilities and side effects
- Error scenarios and recovery procedures

### API Documentation
- Endpoint purpose and use cases
- Request/response examples
- Authentication requirements
- Rate limiting and quotas

### Data Model Documentation
- Entity relationships and constraints
- Field purposes and validation rules
- Query patterns and performance considerations
- Evolution and deprecation plans